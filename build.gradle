plugins {
    id 'java'
    id 'application'
    id 'antlr'
}

group 'devabhasha.nudi'
version '1.0'

sourceCompatibility = 1.8
targetCompatibility = 1.8

mainClassName= 'devabhasha.nudi.Application'

repositories {
    mavenCentral()
}

dependencies {
    antlr "org.antlr:antlr4:4.7.2"
    compile "org.antlr:antlr4-runtime:4.7.2"
    compile "io.vavr:vavr:1.0.0-alpha-3"
}

generateGrammarSource{
    maxHeapSize = "64m"
    arguments += ['-package', 'devabhasha.nudi']
    outputDirectory = new File("${buildDir}/generated-src/antlr/main/devabhasha/nudi".toString())
}

compileJava.dependsOn(generateGrammarSource)

sourceSets {
    generated {
        java.srcDir "${buildDir}/generated-src/antlr/main"
    }
}

compileJava.source sourceSets.generated.java, sourceSets.main.java

jar {
    manifest {
        attributes(
                'Class-Path': configurations.compile.collect { it.getName() }.join(' '),
                'Main-Class': 'devabhasha.nudi.Application'
        )
    }
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
}